var app = angular.module("workerCardApp", ['ngResource']);

app.factory('LinkService', function (){
    return {
        linkService: 'testing is now called!',
        url : "<%= asset_path('index_page.html.erb') %>"

    }
});


app.config(function($routeProvider){
   $routeProvider.when('/',
       {
           templateUrl: "<%= asset_path('index_page.html.erb') %>",
           controller: 'AppCtrl'
       })
       .when('/show_current_user',
       {
            templateUrl:"<%= asset_path('show_current_user.html.erb')%>",
            controller: 'CurrentUserCtrl'
       })
       .when('/test',
           {
               templateUrl: "<%= asset_path('test.html') %>",
               controller: 'TestController'
       })
       .when('/user_logged_in',
           {
               templateUrl: "<%= asset_path('user_logged_in.html.erb') %>",
               controller: 'UserLoggedIn'

       })

});

function homeTemplate($scope, LinkService) {
    $scope.templateA = LinkService.url;
}

function setThisLink() {
    var registerLink = function() {
        var myLink = function($http) {
            //return "<%= asset_path('registration_page.html.erb') %>"
            $http.get('/index').success(function(data){

            })
        };
        return myLink();
    };

    return registerLink();
}
function UserCtrl($scope, LinkService) {
    $scope.data = LinkService.homeLinkService
}



function setHomeTemplate() {
    return {
        link: "<%= asset_path('registration_page.html.erb') %>"
        }
}

app.controller('AppCtrl', function($scope, $http, $location){
    $scope.model = {
        message: 'this is my app!'
    };
    $scope.registerUser = function() {
        $http.put('/register_user/', {
            username: $scope.userName,
            email: $scope.userEmail,
            password: $scope.userPassword,
            password_confirmation: $scope.passwordConfirm
        } ).success(function(){
                    $scope.userName = '';
                    $scope.userEmail = '';
                    $scope.userPassword = '';
                    $scope.passwordConfirm = '';
                   // $('body').css({'background-color': '#ccc'})
                    $location.path('#/user_logged_in');
                });
    };

    function UserLoggedIn() {
        $http.get('/index.json').success(function(data){
            $scope.userIsLoggedIn = data[1];
            alert($scope.userIsLoggedIn)
        })
    }
    var user = new UserLoggedIn();
    function setHomeLinkUrl() {
        if ($scope.userIsLoggedIn == true) {
            $scope.homeLinkUrl = '#/user_logged_in'
        } else {
            $scope.homeLinkUrl = '#/'
        }
    }
});

app.controller('CurrentUserCtrl', function($scope, $http){
   $http.get('/show_current_user').success(function(data){
       //$scope.currentUser = data;
        $scope.users = data;
        $scope.currentUser = data[0];
   })
});

app.controller('UserLoggedIn', function($scope, $http){

});

app.controller('TestController', function($scope){
    $scope.testM = 'test message!';
});

