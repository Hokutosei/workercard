var app = angular.module("workerCardApp", ['ngResource']);

app.factory('LinkService', function (){
    return {
        linkService: 'testing is now called!',
        url : "<%= asset_path('index_page.html.erb') %>"

    }
});


app.config(function($routeProvider){
   $routeProvider.when('/',
       {
           templateUrl: "<%= asset_path('index_page.html.erb') %>",
           controller: 'AppCtrl'
       })
       .when('/show_current_user',
       {
            templateUrl:"<%= asset_path('show_current_user.html.erb')%>",
            controller: 'CurrentUserCtrl'
       })
       .when('/test',
           {
               templateUrl: "<%= asset_path('test.html') %>",
               controller: 'TestController'
       })
       .when('/user_logged_in',
           {
               templateUrl: "<%= asset_path('user_logged_in.html.erb') %>",
               controller: 'UserLoggedIn'
       })
       .when('/logout',
           {
               templateUrl: "<%= asset_path('index_page.html.erb') %>",
               controller: 'UserLogout'
           })

});


function setHomeTemplate() {
    return {
        link: "<%= asset_path('registration_page.html.erb') %>"
        }
}

app.controller('AppCtrl', function($scope, $http, $location){
    $scope.model = {
        message: 'this is my app!'
    };
    $scope.registerUser = function() {
        $http.put('/register_user/', {
            username: $scope.userName,
            email: $scope.userEmail,
            password: $scope.userPassword,
            password_confirmation: $scope.passwordConfirm
        } ).success(function(){
                    $scope.userName = '';
                    $scope.userEmail = '';
                    $scope.userPassword = '';
                    $scope.passwordConfirm = '';
                   // $('body').css({'background-color': '#ccc'})
                    $location.path('#/user_logged_in');
                });
    };
    $scope.UserData = $http.get('/index').success(function(data){
        return data[1];
    });
    $scope.userHomeLink = function(){
        var homeLink;
        if($scope.UserData){
            homeLink = '#/'
        }
        return homeLink
    };
});

app.controller('CurrentUserCtrl', function($scope, $http){
   $http.get('/show_current_user').success(function(data){
        $scope.users = data;
        $scope.currentUser = data[0];
   })
});

app.controller('UserLoggedIn', function($scope, $http){

});

app.controller('UserLogout', function($http, $location){
    $http.put('/logout');
    $location.path('#/');
});

app.controller('TestController', function($scope){
    $scope.testM = 'test message!';
});

